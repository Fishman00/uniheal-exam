<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ„ˆå•†å­¦ç¤¾ | é«˜çº§è®¤è¯å®æˆ˜ç³»ç»Ÿ (å…¨é‡ç‰ˆ)</title>
    <style>
        :root {
            --primary-color: #2c5f58;
            --accent-color: #d4a373;
            --bg-color: #f4f7f6;
            --text-color: #333;
            --white: #ffffff;
            --error: #e74c3c;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* ç™»å½•é®ç½© */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 95, 88, 0.98); display: flex;
            justify-content: center; align-items: center; z-index: 1000;
        }
        .login-box {
            background: white; padding: 2.5rem; border-radius: 12px;
            width: 90%; max-width: 400px; text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .login-box input {
            width: 100%; padding: 12px; margin-bottom: 1rem;
            border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;
        }
        .login-box button {
            width: 100%; padding: 12px; background-color: var(--accent-color);
            color: white; border: none; border-radius: 6px; cursor: pointer;
        }

        /* å¸ƒå±€ */
        header {
            background-color: var(--primary-color); color: var(--white);
            padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center;
        }
        .logout-btn { 
            background: none; border: 1px solid white; color: white; 
            padding: 4px 10px; border-radius: 4px; cursor: pointer; margin-left: 10px;
        }

        nav {
            background: var(--white); display: flex; justify-content: center;
            border-bottom: 1px solid #ddd; position: sticky; top: 0; z-index: 100;
        }
        nav button {
            padding: 1rem 1.5rem; border: none; background: none; font-size: 1rem;
            cursor: pointer; color: #666; border-bottom: 3px solid transparent;
        }
        nav button.active {
            color: var(--primary-color); border-bottom-color: var(--primary-color); font-weight: bold;
        }

        main { max-width: 800px; margin: 2rem auto; width: 90%; padding-bottom: 50px; }

        .card {
            background: var(--white); border-radius: 12px; padding: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 1.5rem;
        }

        .badge {
            background-color: var(--accent-color); color: white; padding: 4px 8px;
            border-radius: 4px; font-size: 0.8rem; margin-right: 8px;
        }
        
        .question-meta { color: #888; font-size: 0.85rem; margin-bottom: 10px; }
        .question-text { font-size: 1.2rem; line-height: 1.6; margin-bottom: 1.5rem; font-weight: 600; }

        .options label {
            display: block; padding: 12px 15px; border: 1px solid #eee;
            border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: background 0.2s;
        }
        .options label:hover { background-color: #f9f9f9; }
        .options input { margin-right: 10px; }

        .btn {
            background-color: var(--primary-color); color: white; border: none;
            padding: 10px 25px; border-radius: 25px; cursor: pointer; font-size: 1rem; margin-right: 10px;
        }
        .btn-outline {
            background-color: transparent; border: 1px solid var(--primary-color); color: var(--primary-color);
        }

        .feedback {
            margin-top: 1.5rem; padding: 1rem; border-radius: 8px;
            background-color: #e8f5e9; border: 1px solid #c8e6c9; display: none;
        }
        .feedback.error { background-color: #ffebee; border: 1px solid #ffcdd2; }

        textarea {
            width: 100%; height: 120px; padding: 10px; border: 1px solid #ccc;
            border-radius: 8px; margin-bottom: 10px; font-family: inherit; box-sizing: border-box;
        }

        .controls { display: flex; justify-content: space-between; margin-top: 2rem; }
        
        .stats-panel {
            display: flex; gap: 10px; margin-bottom: 20px;
        }
        .stat-card {
            flex: 1; background: white; padding: 10px; border-radius: 8px;
            text-align: center; font-size: 0.9rem; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .stat-val { font-size: 1.2rem; font-weight: bold; color: var(--primary-color); display: block;}

        .hidden { display: none !important; }
        
        /* æœç´¢è·³è½¬æ  */
        .jump-bar {
            margin-bottom: 15px; text-align: right;
        }
        .jump-bar input {
            padding: 5px; border-radius: 4px; border: 1px solid #ddd; width: 60px; text-align: center;
        }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h2>æ„ˆå•†å­¦ç¤¾Â·é¢˜åº“å…¨é‡ç‰ˆ</h2>
        <p style="color:#666; margin-bottom: 20px;">è¯·è¾“å…¥ä¼šå‘˜ä¸“å±é€šè¡Œè¯</p>
        <input type="password" id="access-code" placeholder="è¾“å…¥é€šè¡Œç ">
        <button onclick="handleLogin()">è§£é”å…¨å¥—é¢˜åº“</button>
        <p id="login-msg" style="color: var(--error); margin-top: 10px; font-size: 0.9rem;"></p>
    </div>
</div>

<div id="app-container" class="hidden">
    <header>
        <div>
            <h1 style="margin:0; font-size:1.2rem;">æ„ˆå•†å­¦ç¤¾</h1>
            <span style="font-size:0.8rem; opacity:0.8;">UNIHEAL è®¤è¯å®æˆ˜ç³»ç»Ÿ</span>
        </div>
        <div class="user-info">
            <span id="member-id">å­¦å‘˜ï¼šGuest</span>
            <button class="logout-btn" onclick="logout()">é€€å‡º</button>
        </div>
    </header>

    <nav>
        <button class="tab-btn active" onclick="switchSubject('subject1')">ç§‘ç›®ä¸€ï¼šåŸºç¡€ç†è®º</button>
        <button class="tab-btn" onclick="switchSubject('subject2')">ç§‘ç›®äºŒï¼šæŠ€èƒ½å®æ“</button>
        <button class="tab-btn" onclick="switchSubject('subject3')">ç§‘ç›®ä¸‰ï¼šä¼¦ç†æ³•è§„</button>
    </nav>

    <main>
        <div class="stats-panel">
            <div class="stat-card"><span class="stat-val" id="stat-total">0</span>å½“å‰ç§‘ç›®é¢˜æ•°</div>
            <div class="stat-card"><span class="stat-val" id="stat-done">0</span>å·²å®Œæˆ</div>
            <div class="stat-card"><span class="stat-val" id="stat-wrong" style="color:var(--error)">0</span>é”™é¢˜æ•°</div>
        </div>

        <div class="jump-bar">
            è·³è½¬è‡³ç¬¬ <input type="number" id="jump-input" min="1"> é¢˜ 
            <button class="btn-outline" style="padding: 4px 10px; font-size: 0.8rem;" onclick="jumpToQuestion()">GO</button>
        </div>

        <div class="card" id="question-card">
            </div>
        
        <div class="controls">
            <button class="btn btn-outline" onclick="changeQuestion(-1)">ä¸Šä¸€é¢˜</button>
            <div style="text-align: center; color: #999; line-height: 40px;" id="page-indicator">1/1</div>
            <div>
                <button class="btn" onclick="submitAnswer()" id="submit-btn">æäº¤ç­”æ¡ˆ</button>
                <button class="btn btn-outline" onclick="changeQuestion(1)">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>
    </main>
</div>

<script>
    // ==========================================
    // âš ï¸ æ ¸å¿ƒåŒºåŸŸï¼šè¯·åœ¨æ­¤å¤„ç²˜è´´åŸå§‹æ–‡æœ¬
    // ==========================================
    
    // 1. è¯·å°†ã€ç§‘ç›®ä¸€ã€‘PDFä¸­çš„å…¨éƒ¨æ–‡å­—ç²˜è´´åˆ°ä¸‹æ–¹çš„åå¼•å· `` ä¹‹é—´
    const rawSubject1 = `
ç§‘ç›®ä¸€ï¼šåŸºç¡€ç†è®ºæ¨¡å—(å•é€‰ 180ï¼Œå¤šé€‰ 40ï¼Œç®€ç­” 40)

å•é€‰é¢˜ï¼ˆ180 é¢˜ï¼‰

1. çš®äºšæ°è®¤çŸ¥å‘å±•é˜¶æ®µç†è®ºä¸­"å®¢ä½“æ°¸å­˜æ€§"æ¦‚å¿µå‡ºç°åœ¨å“ªä¸ªé˜¶æ®µï¼Ÿ

A. æ„ŸçŸ¥è¿åŠ¨é˜¶æ®µ

B. å‰è¿ç®—é˜¶æ®µ

C. å…·ä½“è¿ç®—é˜¶æ®µ

D. å½¢å¼è¿ç®—é˜¶æ®µ

ç­”æ¡ˆï¼šA

(æ­¤å¤„çœç•¥ï¼Œè¯·å°†ç§‘ç›®ä¸€å‰©ä½™å†…å®¹å®Œæ•´ç²˜è´´è¦†ç›–æ­¤å¤„...)
    `;

    // 2. è¯·å°†ã€ç§‘ç›®äºŒã€‘PDFä¸­çš„å…¨éƒ¨æ–‡å­—ç²˜è´´åˆ°ä¸‹æ–¹çš„åå¼•å· `` ä¹‹é—´
    const rawSubject2 = `
ç§‘ç›®äºŒï¼šæŠ€èƒ½å®æ“æ¨¡å—ï¼ˆ46 é¢˜ï¼‰

æ¡ˆä¾‹åˆ†æé¢˜ï¼ˆ46 é¢˜ï¼‰

1. æ¡ˆä¾‹ï¼šæŸäº’è”ç½‘å…¬å¸å‘˜å·¥æ™®éå­˜åœ¨â€œç¡çœ éšœç¢+ç¤¾äº¤é€€ç¼©â€çš„äºšå¥åº·çŠ¶æ€ã€‚è¯·è®¾è®¡ä¸€å¥—ç»“åˆæ­£å¿µå†¥æƒ³ä¸å‘¼å¸ç–—æ³•çš„ 8å‘¨å¹²é¢„è®¡åˆ’ï¼Œç®€è¿°æ¯å‘¨çš„ç›®æ ‡ä¸æ–¹æ³•ã€‚

ç­”æ¡ˆï¼šç³»ç»Ÿè¯„åˆ†

(æ­¤å¤„çœç•¥ï¼Œè¯·å°†ç§‘ç›®äºŒå‰©ä½™å†…å®¹å®Œæ•´ç²˜è´´è¦†ç›–æ­¤å¤„...)
    `;

    // 3. è¯·å°†ã€ç§‘ç›®ä¸‰ã€‘PDFä¸­çš„å…¨éƒ¨æ–‡å­—ç²˜è´´åˆ°ä¸‹æ–¹çš„åå¼•å· `` ä¹‹é—´
    const rawSubject3 = `
ç§‘ç›®ä¸‰ï¼šä¼¦ç†ä¸æ³•è§„æ¨¡å—ï¼ˆ46 é¢˜ï¼‰

è®ºè¿°é¢˜ï¼ˆ46 é¢˜ï¼‰

1. æŸå’¨è¯¢å¸ˆåœ¨ç¤¾åŒºç–—æ„ˆæ´»åŠ¨ä¸­é‡åˆ°æœåŠ¡å¯¹è±¡è¡¨è¾¾äº†æ˜æ˜¾çš„å¿ƒç†å›°æ‰°å’Œæ½œåœ¨é£é™©è¡Œä¸ºæš—ç¤ºï¼Œä½†æ‹’ç»è®©å’¨è¯¢å¸ˆè”ç³»å®¶å±ã€‚è¯·ä¾æ®ä¸­å›½ç›¸å…³æ³•å¾‹å’ŒèŒä¸šä¼¦ç†è¯´æ˜å’¨è¯¢å¸ˆåº”å¦‚ä½•åº”å¯¹è¯¥æƒ…å½¢ã€‚

ç­”æ¡ˆï¼šç³»ç»Ÿè¯„åˆ†

(æ­¤å¤„çœç•¥ï¼Œè¯·å°†ç§‘ç›®ä¸‰å‰©ä½™å†…å®¹å®Œæ•´ç²˜è´´è¦†ç›–æ­¤å¤„...)
    `;

    // ==========================================
    // âš ï¸ æ™ºèƒ½è§£æå¼•æ“ (è‡ªåŠ¨å¤„ç†ç²˜è´´çš„æ–‡æœ¬)
    // ==========================================
    const fullQuestionBank = { subject1: [], subject2: [], subject3: [] };

    function parseRawText(text, subjectKey, defaultType, defaultCat) {
        const lines = text.split('\n').map(l => l.trim()).filter(l => l);
        let currentQ = null;
        let currentType = defaultType; // single, multiple, text
        let currentCategory = defaultCat;

        // è¯†åˆ«ç§‘ç›®ä¸€ä¸­çš„ä¸åŒé¢˜å‹åŒºå—
        const typeKeywords = {
            "å•é€‰é¢˜": { type: "single", cat: "å•é€‰é¢˜" },
            "å¤šé€‰é¢˜": { type: "multiple", cat: "å¤šé€‰é¢˜" },
            "ç®€ç­”é¢˜": { type: "text", cat: "ç®€ç­”é¢˜" },
            "æ¡ˆä¾‹åˆ†æ": { type: "text", cat: "æ¡ˆä¾‹åˆ†æ" },
            "è®ºè¿°é¢˜": { type: "text", cat: "è®ºè¿°é¢˜" }
        };

        lines.forEach(line => {
            // 1. æ£€æŸ¥æ˜¯å¦åˆ‡æ¢äº†é¢˜å‹åŒºå— (ä»…é’ˆå¯¹æœ‰æ··åˆé¢˜å‹çš„ç§‘ç›®)
            for (let k in typeKeywords) {
                if (line.includes(k) && (line.includes("é¢˜ï¼‰") || line.includes("é¢˜)"))) {
                    currentType = typeKeywords[k].type;
                    currentCategory = typeKeywords[k].cat;
                }
            }

            // 2. åŒ¹é…é¢˜ç›® (æ”¯æŒ "1. " æˆ– "1ã€")
            // æ’é™¤ "å•é€‰é¢˜ï¼ˆ180 é¢˜ï¼‰" è¿™ç§æ ‡é¢˜è¡Œï¼ŒåªåŒ¹é…ä»¥æ•°å­—å¼€å¤´ä¸”åé¢è·Ÿæ ‡ç‚¹çš„
            const qMatch = line.match(/^(\d+)[.ã€]\s*(.*)/);
            if (qMatch) {
                if (currentQ) fullQuestionBank[subjectKey].push(currentQ);
                currentQ = {
                    id: parseInt(qMatch[1]),
                    type: currentType,
                    category: currentCategory,
                    question: qMatch[2], // åˆå§‹é¢˜ç›®å†…å®¹
                    options: [],
                    answer: "",
                    explanation: `å‡ºè‡ª${currentCategory}ç¬¬${qMatch[1]}é¢˜`
                };
                return;
            }

            // 3. å¦‚æœå½“å‰è¡Œä¸æ˜¯é¢˜ç›®ï¼Œä¸”æœ‰currentQï¼Œåˆ™å¯èƒ½æ˜¯é¢˜ç›®å†…å®¹çš„å»¶ç»­ã€é€‰é¡¹æˆ–ç­”æ¡ˆ
            if (currentQ) {
                // åŒ¹é…é€‰é¡¹ (A. xxx)
                const optMatch = line.match(/^([A-E])[.ã€]\s*(.*)/);
                if (optMatch && (currentQ.type === 'single' || currentQ.type === 'multiple')) {
                    currentQ.options.push(line); // ä¿å­˜å®Œæ•´é€‰é¡¹æ–‡æœ¬
                    return;
                }

                // åŒ¹é…ç­”æ¡ˆ
                const ansMatch = line.match(/^ç­”æ¡ˆ[ï¼š:]\s*(.*)/);
                if (ansMatch) {
                    let ansText = ansMatch[1].trim();
                    if (currentQ.type === 'multiple') {
                        currentQ.answer = ansText.split('').filter(c => /[A-E]/.test(c));
                    } else {
                        currentQ.answer = ansText;
                    }
                    return;
                }

                // å¦‚æœæ—¢ä¸æ˜¯é€‰é¡¹ä¹Ÿä¸æ˜¯ç­”æ¡ˆï¼Œä¸”è¿˜æ²¡é‡åˆ°é€‰é¡¹/ç­”æ¡ˆï¼Œå¯èƒ½æ˜¯é¢˜ç›®æè¿°çš„ç¬¬äºŒè¡Œ
                if (currentQ.options.length === 0 && !currentQ.answer) {
                    // ç®€å•åˆ¤æ–­ï¼šå¦‚æœè¿™è¡Œä¸åŒ…å«"[source"ï¼Œåˆ™æ‹¼æ¥åˆ°é¢˜ç›®å
                    if (!line.includes('[source')) {
                        currentQ.question += " " + line;
                    }
                }
            }
        });

        // æ¨å…¥æœ€åä¸€é¢˜
        if (currentQ) fullQuestionBank[subjectKey].push(currentQ);
    }

    // ç³»ç»Ÿå¯åŠ¨æ—¶æ‰§è¡Œè§£æ
    function initData() {
        parseRawText(rawSubject1, 'subject1', 'single', 'å•é€‰é¢˜');
        parseRawText(rawSubject2, 'subject2', 'text', 'æ¡ˆä¾‹åˆ†æ');
        parseRawText(rawSubject3, 'subject3', 'text', 'è®ºè¿°é¢˜');
        console.log("é¢˜åº“è§£æå®Œæˆ", fullQuestionBank);
    }

    // ==========================================
    // é€»è¾‘æ§åˆ¶ (ç™»å½•ã€äº¤äº’)
    // ==========================================
    const PASS_CODE = "YSXS2025"; // âœ… åœ¨è¿™é‡Œè®¾ç½®ä½ çš„ç¤¾ç¾¤å¯†ç 
    let state = { subject: 'subject1', index: 0, answers: {}, mode: 'practice' };
    let stats = { done: 0, wrong: 0 };

    window.onload = function() {
        if(localStorage.getItem('uniheal_user')) {
            showApp(localStorage.getItem('uniheal_user'));
        }
    };

    function handleLogin() {
        const input = document.getElementById('access-code').value;
        if(input === PASS_CODE) {
            const userId = 'VIP_' + Math.floor(Math.random()*8888);
            localStorage.setItem('uniheal_user', userId);
            showApp(userId);
        } else {
            document.getElementById('login-msg').innerText = "å¯†ç é”™è¯¯ï¼Œè¯·å…³æ³¨æ„ˆå•†å­¦ç¤¾å…¬ä¼—å·è·å–";
        }
    }

    function showApp(userId) {
        initData(); // å…ˆè§£ææ•°æ®
        document.getElementById('login-overlay').style.display = 'none';
        document.getElementById('app-container').classList.remove('hidden');
        document.getElementById('member-id').innerText = userId;
        loadSubject('subject1');
    }

    function logout() {
        localStorage.removeItem('uniheal_user');
        location.reload();
    }

    function switchSubject(sub) {
        state.subject = sub;
        state.index = 0;
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
            if(btn.onclick.toString().includes(sub)) btn.classList.add('active');
        });
        loadSubject(sub);
    }

    function loadSubject(sub) {
        state.index = 0;
        updateStats();
        renderQuestion();
    }

    function renderQuestion() {
        const list = fullQuestionBank[state.subject];
        if(!list || list.length === 0) {
            document.getElementById('question-card').innerHTML = "<p>æ•°æ®åŠ è½½ä¸­æˆ–æ— æ•°æ®ï¼Œè¯·æ£€æŸ¥ä»£ç ä¸­çš„ç²˜è´´åŒºåŸŸã€‚</p>";
            return;
        }
        const data = list[state.index];
        const card = document.getElementById('question-card');
        
        document.getElementById('page-indicator').innerText = `${state.index + 1} / ${list.length}`;
        document.getElementById('stat-total').innerText = list.length;

        let html = `
            <div class="question-meta">
                <span class="badge">${data.category}</span>
                <span>ID: ${data.id}</span>
            </div>
            <div class="question-text">${data.question}</div>
        `;

        if (data.type === 'single' || data.type === 'multiple') {
            const inputType = data.type === 'single' ? 'radio' : 'checkbox';
            html += `<div class="options">`;
            data.options.forEach((opt) => {
                // æå–é€‰é¡¹å­—æ¯ï¼Œå¦‚ "A. xxx" -> value="A"
                const val = opt.charAt(0); 
                html += `
                    <label onclick="selectOption(this)">
                        <input type="${inputType}" name="q_opt" value="${val}">
                        ${opt}
                    </label>
                `;
            });
            html += `</div>`;
        } else {
            html += `<textarea placeholder="ã€æ¨¡æ‹Ÿå®æˆ˜ã€‘åœ¨æ­¤è¾“å…¥ä½ çš„æ€è€ƒè¦ç‚¹..."></textarea>`;
        }

        html += `
            <div id="feedback" class="feedback">
                <strong>ğŸ’¡ å‚è€ƒè§£æï¼š</strong><br>
                <div style="margin:5px 0; color:#2c5f58; font-weight:bold;">${Array.isArray(data.answer) ? data.answer.join('') : data.answer}</div>
                <div style="font-size:0.9rem; color:#666;">${data.explanation}</div>
            </div>
        `;

        card.innerHTML = html;
        resetSubmitBtn();
    }

    function submitAnswer() {
        const list = fullQuestionBank[state.subject];
        const data = list[state.index];
        const feedback = document.getElementById('feedback');
        
        if(data.type === 'single' || data.type === 'multiple') {
            const checked = document.querySelectorAll('input[name="q_opt"]:checked');
            if(checked.length === 0) return alert('è¯·å…ˆé€‰æ‹©ç­”æ¡ˆ');
            
            const userVal = Array.from(checked).map(c => c.value).sort();
            const correctVal = Array.isArray(data.answer) ? data.answer.sort() : [data.answer];
            
            const isCorrect = JSON.stringify(userVal) === JSON.stringify(correctVal);
            
            if(isCorrect) {
                feedback.classList.remove('error');
                feedback.innerHTML = `<strong>âœ… å›ç­”æ­£ç¡®</strong>`;
                stats.done++;
            } else {
                feedback.classList.add('error');
                feedback.innerHTML = `<strong>âŒ å›ç­”é”™è¯¯</strong><br>æ­£ç¡®ç­”æ¡ˆï¼š${correctVal.join('')}`;
                stats.done++;
                stats.wrong++;
            }
        } else {
            feedback.classList.remove('error');
        }

        feedback.style.display = 'block';
        document.getElementById('submit-btn').disabled = true;
        document.getElementById('submit-btn').innerText = "å·²æŸ¥çœ‹";
        updateStats();
    }

    function resetSubmitBtn() {
        const btn = document.getElementById('submit-btn');
        btn.innerText = 'æäº¤ç­”æ¡ˆ';
        btn.disabled = false;
        document.getElementById('feedback').style.display = 'none';
    }

    function changeQuestion(dir) {
        const list = fullQuestionBank[state.subject];
        const newIndex = state.index + dir;
        if(newIndex >= 0 && newIndex < list.length) {
            state.index = newIndex;
            renderQuestion();
        } else {
            alert(dir > 0 ? "å·²ç»æ˜¯æœ€åä¸€é¢˜" : "å·²ç»æ˜¯ç¬¬ä¸€é¢˜");
        }
    }

    function jumpToQuestion() {
        const val = parseInt(document.getElementById('jump-input').value);
        const list = fullQuestionBank[state.subject];
        if(val > 0 && val <= list.length) {
            state.index = val - 1;
            renderQuestion();
        } else {
            alert("é¢˜å·è¶…å‡ºèŒƒå›´");
        }
    }
    
    function updateStats() {
        document.getElementById('stat-done').innerText = stats.done;
        document.getElementById('stat-wrong').innerText = stats.wrong;
    }

</script>
</body>
</html>